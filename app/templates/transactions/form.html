{% extends "base.html" %}
{% block title %}{{ "Edit" if txn else "New" }} Transaction{% endblock %}

{% block content %}
<div class="container mx-auto max-w-xl">
  <h1 class="text-2xl font-semibold mb-4">{{ "Edit" if txn else "New" }} Transaction</h1>

  {% if errors %}
    <div class="mb-4 rounded border border-red-300 bg-red-50 text-red-800 p-3">
      <ul class="list-disc list-inside">
        {% for e in errors %}
          <li>{{ e }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% set is_edit = txn is not none %}
  <form method="post" action="{{ '/transactions/' ~ txn.id ~ '/edit' if is_edit else '/transactions/new' }}" class="space-y-3">
    {% set tval = (txn.type.value if txn and txn.type else '') %}

    <div>
      <label class="block mb-1">Type</label>
      <select name="type" class="w-full border rounded p-2">
        <option value="income" {{ 'selected' if tval == 'income' else '' }}>Income</option>
        <option value="expense" {{ 'selected' if tval == 'expense' else '' }}>Expense</option>
      </select>
    </div>

    <div>
      <label class="block mb-1">Category</label>
      <input name="category" class="w-full border rounded p-2" value="{{ txn.category if txn else '' }}" required>
    </div>

    <div>
      <label class="block mb-1">Subcategory</label>
      <input name="subcategory" class="w-full border rounded p-2" value="{{ txn.subcategory if txn and txn.subcategory else '' }}">
    </div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="block mb-1">Amount</label>
        <input name="amount" type="number" step="0.01" class="w-full border rounded p-2" value="{{ txn.amount if txn else '' }}" required>
      </div>
      <div>
        <label class="block mb-1">Currency</label>
        <input name="currency" class="w-full border rounded p-2" value="{{ txn.currency if txn else (budget.base_currency if budget else 'EUR') }}">
      </div>
    </div>

    <div>
      <label class="block mb-1">Date</label>
      <input name="txn_date" type="date" class="w-full border rounded p-2" value="{{ txn.txn_date if txn else '' }}" required>
    </div>

    <div>
      <label class="block mb-1">Notes</label>
      <textarea name="notes" rows="2" class="w-full border rounded p-2">{{ txn.notes if txn and txn.notes else '' }}</textarea>
    </div>

    <div class="flex items-center justify-between pt-2">
      <a href="/transactions" class="text-gray-600">Back</a>
      <button class="px-3 py-2 rounded bg-blue-600 text-white">{{ "Save" if is_edit else "Create" }}</button>
    </div>
  </form>
</div>
{% endblock %}